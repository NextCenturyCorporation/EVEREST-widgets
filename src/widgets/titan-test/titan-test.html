<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>Titan Server Grab -- Test</title>
	<script src="../../../lib/jquery-2.0.2.js"></script>
	<script src="../../../lib/d3.v3.min.js"></script>
	<script src="../../components/assertionGraph/network.js"></script>
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<script type="text/javascript">
		var url='http://everest-build:8182/graphs/graph/';
		var nodes = [];
		var edges = [];
		
		var white = '#ff9966';
		var entity1Color = '#333399';
		var entity2Color = '#339966';
		var bothColor = '#9900cc';
	
		var svg = d3.select('body').append('svg')
			.attr('width', 1000)
			.attr('height', 750);
					
		var net = new network(svg, []);
		$.ajax({
			type: "GET",
			url: url + 'tp/gremlin?script=g.V',
			success: function(r){
				nodes = r.results;
			},
			error: function(){console.log('error getting verts');},
			complete: function(r){
				$.ajax({
					type: "GET",
					url: url + 'tp/gremlin?script=g.E',
					success: function(r1){
						console.log(r1);
						edges = r1.results;
					},
					error: function(){console.log('error getting edges');},
					complete: function(){
						for (var i = 0; i < nodes.length; i++){
							nodes[i].value = nodes[i].name;
							nodes[i].color = white;
						}
						
						for (var i = 0; i < edges.length; i++){
								var source = edges[i]._outV;
								var target = edges[i]._inV;
	
							for (var j = 0; j < nodes.length; j++){
								
								if (nodes[j]._id === source){
									edges[i].source = j;
									if ( edges[i]._label !== 'meta of' ){
										if (nodes[j].color === white){
											nodes[j].color = entity1Color;
										} else if (nodes[j].color != entity1Color){
											nodes[j].color = bothColor;
										}
									}
								} else if (nodes[j]._id === target){
									edges[i].target = j;
									if ( edges[i]._label !== 'meta of' ){
										if (nodes[j].color === white){
											nodes[j].color = entity2Color;
										} else if (nodes[j].color != entity2Color){
											nodes[j].color = bothColor;
										}
									}
								}
							
							}
							edges[i].value = edges[i]._label;
						}
						net.setNodes(nodes);
						net.setLinks(edges);
						net.draw();
					}
				});
			}
		});
	</script>
	
</body>
</html>
